flowchart TB
    subgraph HighLevel["High-level orchestration"]
        CFG[config<br/>Config, Session]
        ING[ingest+verify<br/>Manifest, verification_summary.json]
        PIPE[pipeline/cli<br/>run_session, run_validation]
        VAL[validate<br/>validation_report.json]
        QC[qc<br/>QC HTML]
    end

    subgraph MidLevel["Mid-level tools"]
        SYNC[sync<br/>timebase, alignment models]
        NWB[nwb<br/>NWB assembly]
    end

    subgraph LowLevel["Low-level tools"]
        U[utils]
        BPOD[events.bpod]
        TRIALS[events.trials]
        POSE[pose]
        FM[facemap]
        TR[transcode]
        SPRIM[sync.primitives]
    end

    %% High-level → Mid-level
    PIPE --> SYNC
    PIPE --> NWB
    ING --> PIPE
    CFG --> ING
    CFG --> PIPE
    PIPE --> VAL
    PIPE --> QC

    %% Mid-level → Low-level
    SYNC --> SPRIM
    SYNC --> U
    NWB --> U

    %% High-level → Low-level
    PIPE --> BPOD
    PIPE --> TRIALS
    PIPE --> POSE
    PIPE --> FM
    PIPE --> TR
    ING --> U

    %% Low-level → utils
    BPOD --> U
    TRIALS --> U
    POSE --> U
    FM --> U
    TR --> U